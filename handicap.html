<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Handicap Summary</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav>
    <ul>
      <li><a href="index.html">Enter Scores</a></li>
      <li><a href="handicap.html">View Handicaps</a></li>
    </ul>
  </nav>
  <main>
    <h1>Handicap Summary</h1>
    <div class="table-scroll">
      <table id="handicapTable" class="scorecard">
        <colgroup>
          <col style="width:150px;">   <!-- Name -->
          <col style="width:150px;">   <!-- Course -->
          <col style="width:100px;">   <!-- Tee -->
          <col style="width:100px;">   <!-- Avg Score -->
          <col style="width:100px;">   <!-- Handicap Differential -->
        </colgroup>
        <thead>
          <tr>
            <th>Name</th>
            <th>Course</th>
            <th>Tee</th>
            <th>Avg Score</th>
            <th>Handicap Differential</th>
          </tr>
        </thead>
        <tbody id="handicapBody"></tbody>
      </table>
    </div>
  </main>
  <script>
    const ratings = {
      'Charwood-Green': { rating: 67.8, slope: 126 },
      'Charwood-Red':   { rating: 69.7, slope: 129 },
      'Spur-Blue':      { rating: 71.9, slope: 122 },
      'Spur-Back':      { rating: 70.4, slope: 118 }
    };

    fetch('scores_data_final.json')
      .then(response => response.json())
      .then(json => {
        const local = JSON.parse(localStorage.getItem("golfScores") || "[]");
        const allRounds = [...json, ...local];
        const groups = {};
        allRounds.forEach(entry => {
          const key = `${entry.name}-${entry.course}-${entry.tee}`;
          if (!groups[key]) groups[key] = [];
          if (!isNaN(entry.total)) groups[key].push(entry.total);
        });
        const tbody = document.getElementById("handicapBody");
        tbody.innerHTML = "";
        Object.entries(groups).forEach(([key, scores]) => {
          const [name, course, tee] = key.split("-");
          const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
          const id = `${course}-${tee}`;
          let diff = "N/A";
          if (ratings[id]) {
            const { rating, slope } = ratings[id];
            diff = (((avgScore - rating) * 113) / slope).toFixed(1);
          }
          const row = document.createElement("tr");
          row.innerHTML = `<td>${name}</td><td>${course}</td><td>${tee}</td><td>${avgScore.toFixed(1)}</td><td>${diff}</td>`;
          tbody.appendChild(row);
        });
      })
      .catch(err => console.error("Error loading or parsing JSON:", err));
  </script>
</body>
</html>

